<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<style>
		body {
			margin: 0;
			padding: 0;
			background: white;
  			color: black;
			font-family: "Joan", Georgia, 'Palatino Linotype', serif;
		}

		.container {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			height: 100vh;
			text-align: center;
			padding: 1em;
			box-sizing: border-box;
		}

		.quote-box {
			font-size: clamp(1rem, 2.5vw, 3rem);
			line-height: 1.5;
			position: relative;
			margin-bottom: 2em;
			max-width: 90%;
			padding: 2rem;
		}

		.quote-box::before {
			content: "“";
			font-size: clamp(3rem, 13vw, 12rem);
			position: absolute;
			top: 1rem;
			margin-right: 1rem;
			line-height: 0;
			color: gray;
		}

		.quote-box::after {
			content: "”";
			font-size: clamp(3rem, 13vw, 12rem);
			position: absolute;
			bottom: -1rem;
			right: 0;
			line-height: 0;
			margin-left: 1rem;
			color: gray;
		}

		#quote {
			display: inline-block;
			margin: 0 1em;
		}

		.footer {
			font-size: 0.75em;
			font-size: clamp(0.75rem, 1vw, 1.5rem);
			color: gray;
			a {
				color: darkgray;
			}
		}

		/* Dark mode styles */
		@media (prefers-color-scheme: dark) {
  			body {
				background: black;
  				color: white;
			}
			.quote-box::before {
				color: gray;
			}
			.quote-box::after {
				color: gray;
			}
			.footer {
				color: gray;
				a {
					color: lightgray;
				}
			}
		}
	</style>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Caudex:ital,wght@0,400;0,700;1,400;1,700&family=Joan&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body class="colorMode">
	<div class="container">
		<div class="quote-box">
			<span id="quote">Loading wisdom…</span>
		</div>
		<div class="footer">
			The Wisdom Project — Merlin Mann — <a href="http://wisdom.limo">wisdom.limo</a>
		</div>
	</div>

	<script>
		function markdownToHTML (text) {
			return text
				.replace(/^-\s+/, '')                            // Remove leading "- "
				.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
				.replace(/\*(.*?)\*/g, '<em>$1</em>')             // Italic
				.replace(/`([^`]+)`/g, '<code>$1</code>')         // Inline code
				.replace(/~~(.*?)~~/g, '<s>$1</s>');              // Strikethrough
		}

		function hashString (str) {
			let hash = 0;
			for (let i = 0; i < str.length; i++) {
				hash = ((hash << 5) - hash) + str.charCodeAt(i);
				hash |= 0;
			}
			return Math.abs(hash);
		}

		async function getQuote () {
			const url = 'https://raw.githubusercontent.com/merlinmann/wisdom/master/wisdom.md';
			const res = await fetch(url);
			const text = await res.text();

			const [, afterHeader] = text.split(/The Wisdom so far/i);
			const [wisdomBlock] = afterHeader.split(/Works Cited/i);

			if (!wisdomBlock) {
				document.querySelector('#quote').textContent = 'No wisdom found.';
				return;
			}

			const quotes = wisdomBlock
				.split('\n')
				.map(q => q.trim().replace(/^-\s+/, ''))
				.filter(q => q.length > 0)
				.filter(q => {
				const cleaned = q.trim();
				return cleaned.length > 0 
					&& !/^[-*_]{3,}$/.test(cleaned)
					&& !cleaned.startsWith('<!--')
					&& cleaned !== '-->';
				});

			// Pick a deterministic quote based on today's date
			const dateSeed = new Date().toISOString().slice(0, 10); // "YYYY-MM-DD"
			const quoteIndex = hashString(dateSeed) % quotes.length;
			const selected = quotes[quoteIndex];

			document.querySelector('#quote').innerHTML = markdownToHTML(selected);
		}
		getQuote();
	</script>
</body>
</html>
